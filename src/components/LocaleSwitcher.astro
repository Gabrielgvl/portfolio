---
import { languages } from '../i18n/ui';
import { getLocaleFromUrl, useTranslatedPath, getRouteFromUrl } from '../i18n/utils';

const locale = getLocaleFromUrl(Astro.url);
const translatePath = useTranslatedPath(locale);
const route = getRouteFromUrl(Astro.url);
---

<div class="relative group">
  <button
    type="button"
    class="flex items-center space-x-1 text-slate-600 hover:text-accent-500 dark:text-slate-300 dark:hover:text-accent-400 transition-colors"
    aria-haspopup="true"
  >
    <span>üåê</span>
  </button>

  <div class="absolute right-0 pt-2 w-48">
    <div
      class="rounded-md shadow-lg bg-white dark:bg-slate-900 ring-1 ring-black ring-opacity-5 transform opacity-0 scale-95 invisible group-hover:opacity-100 group-hover:scale-100 group-hover:visible transition-all duration-200 ease-in-out origin-top-right"
    >
      <div class="py-1">
        {
          Object.entries(languages).map(([lang, label]) => (
            <a
              href={translatePath(`/${route ? route : ''}`, lang)}
              data-locale={lang}
              class={`block px-4 py-2 text-sm ${
                locale === lang
                  ? 'text-accent-500 dark:text-accent-400 bg-slate-50 dark:bg-slate-800'
                  : 'text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-800'
              } cursor-pointer`}
            >
              {label}
            </a>
          ))
        }
      </div>
    </div>
  </div>
</div>

<script is:inline>
  document.querySelectorAll('[data-locale]').forEach((link) => {
    link.addEventListener('click', () => {
      const locale = link.getAttribute('data-locale');
      if (!locale) return;
      document.cookie = `locale=${locale}; Path=/; Max-Age=31536000; SameSite=Lax`;
    });
  });
</script>
